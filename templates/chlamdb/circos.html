<!DOCTYPE html>


<html>
<head>
{% load static %}
{% load static %}
{% load crispy_forms_tags %}
<link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}" />
<script src='https://cdnjs.cloudflare.com/ajax/libs/d3/4.5.0/d3.js'></script>
<script src="{% static 'js/circos.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.1.0/chroma.min.js" integrity="sha512-yocoLferfPbcwpCMr8v/B0AB4SWpJlouBwgE0D3ZHaiP1nuu5djZclFEIj9znuqghaZ3tdCMRrreLoM8km+jIQ==" crossorigin="anonymous"></script>


{% include "chlamdb/header.html" %}
</head>
<body>

  <div class="container-fluid" id="main_container">
    <div class="row">
      <div id="wrapper">
          <div id="page-content-wrapper">
            <div class="row">
              <div class="col-lg-12">
                 {% include "chlamdb/menu.html" %}
                 <div class="home-title"><b> Circos  </b></div>
                 <hr class="lines-home">

                  <div class="panel panel-success" style="width:80%; top: 200px; margin: 10px 10px 10px 10px">
                      <div class="panel-heading" style="width:100%">
                          <h3 class="panel-title">Help</h3>
                      </div>
                      <div style="margin: 10px 10px 10px 10px; padding-left:20px"><h3>Circos plots indicating the presence(red scale)/absence(light blue) of homologous proteins in one or multiple other genomes. </h3>
                      Click on features to get detailed information about the corresponding locus.
                       <ul id="circos_ul" style="list-style-type:disc;">  
                            <li>The first outer circle show contig/chromosome boundaries</li>
                            <li>The second and third circles show open reading frames from the reference genome (in gray)</li>
                            <ol>
                                <li>rRNA are colored in blue, tRNA in red</li>
                            </ol>
                            <li>Inner blue/red circle(s) indicate the presence(red scale)/absence(light blue) of homologous proteins in one or multiple other genomes</li>                            
                      </ul>
                    </div>
                  </div>
                  <div class="row">

                    {% block content %}
                    <form action="{% url "circos" %}" method="post" id="circos-form">
                        {% csrf_token %}
                        {% crispy form %}
                    </form>
                    {% endblock %}

                  </div>
                  <div id='download' class='download'></div>
                  <div id='heatmapChart' class='chartclass'></div>

              </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

{% include "chlamdb/style_menu.html" %}



<script type="text/javascript">
function hide_submenus(hidden_menu) {

var menu_ul = $('.' + hidden_menu +'> ul'),
    menu_a  = $('.' + hidden_menu +'> a');

menu_ul.hide();

menu_a.click(function(e) {
    e.preventDefault();
    if(!$(this).hasClass('active')) {
        menu_a.removeClass('active');
        menu_ul.filter(':visible').slideUp('normal');
        $(this).addClass('active').next().stop(true,true).slideDown('normal');
    } else {
        $(this).removeClass('active');
        $(this).next().stop(true,true).slideUp('normal');
    }
});

};

$(hide_submenus("rollmenu1"))


{{js_code|safe}}

{% if envoi %}
  $(document).ready(function(){
    d3.select("#download").append("button")
            .attr("type","button")
            .attr("class", "btn btn-primary btn-sm")
            .text("Download SVG")
            .on("click", function() {
                // download the svg
    //get svg element.
    var svg = document.getElementsByTagName('svg')[0];
    var svgData =  document.getElementsByTagName('svg')[0].outerHTML;
    console.log(svgData)
    var preface = '<?xml version="1.0" standalone="no"?>\r\n';
    var svgBlob = new Blob([preface, svgData], {type:"image/svg+xml;charset=utf-8"});
    var svgUrl = URL.createObjectURL(svgBlob);
    var downloadLink = document.createElement("a");
    downloadLink.href = svgUrl;
    downloadLink.download = "circos.svg";
    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
            });
  });
{% endif %}
</script>

</html>
